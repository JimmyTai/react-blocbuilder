{"version":3,"sources":["data_bloc.js","../../node_modules/rxjs/_esm5/internal/util/isArray.js","../../node_modules/rxjs/_esm5/internal/util/isObject.js","../../node_modules/rxjs/_esm5/internal/util/UnsubscriptionError.js","../../node_modules/rxjs/_esm5/internal/Subscription.js","../../node_modules/rxjs/_esm5/internal/util/isFunction.js","../../src/bloc_builder.tsx","App.js","index.js"],"names":["DataBloc","_disposables","Subscription","list","BehaviorSubject","dispose","this","unsubscribe","getData","it","Observable","create","subscriber","a","Promise","resolve","reject","setTimeout","next","complete","error","subscribe","data","err","add","isArray","Array","x","length","isObject","UnsubscriptionError","UnsubscriptionErrorImpl","errors","Error","call","message","map","i","toString","join","name","prototype","Object","closed","_parentOrParents","_subscriptions","_unsubscribe","empty","remove","index","e","flattenUnsubscriptionErrors","len","sub","concat","push","teardown","subscription","EMPTY","tmp","indexOf","subscriptions","subscriptionIndex","splice","reduce","errs","BlocBuilder","useState","snapshot","props","connectionState","undefined","state","setState","useEffect","App","bloc","useRef","_bloc","current","style","margin","initialValue","getValue","subject","builder","JSON","stringify","onClick","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.64a9e931.chunk.js","sourcesContent":["import { Subscription, BehaviorSubject, Observable } from 'rxjs';\n// 引入RxJS庫\n// Subscription是用來管理資料流\n// BehaviorSubject是一個廣播資料流，可以有預設數值，通常用來儲存狀態\n// Observable，可以利用create創建一個流，通常可以將API包在裡面\n\nexport class DataBloc {\n  // 用來管理資料流\n  _disposables = new Subscription();\n\n  // 資料儲存在這\n  list = new BehaviorSubject([]);\n\n  // 當頁面關閉會呼叫，銷毀所有的訂閱\n  dispose() {\n    this._disposables.unsubscribe();\n  }\n\n  getData() {\n    // 模擬一支API用RxJS包裝，通常將同一類型的API寫在另一個js或ts裡\n    const observable =\n      Observable.create(async subscriber => {\n        try {\n          await new Promise((resolve, reject) => {\n            setTimeout(() => resolve(), 2000);\n          });\n          subscriber.next(['data_01', 'data_02']);\n          subscriber.complete();\n        }\n        catch (e) {\n          subscriber.error(e);\n        }\n      });\n    // 呼叫API，並訂閱資料流\n    const it = observable.subscribe({\n      next: data => {\n        // 當API成功後會傳回data，更新list這個BehaviorSubject，\n        // 有訂閱這個流的會收到通知，也可以透過getValue()獲取\n        // 最新的狀態\n        this.list.next(data);\n      },\n      error: err => {\n        // 當API失敗，可以做例外處理\n      },\n    });\n    // 將這個訂閱加到disposables中，集中管理\n    this._disposables.add(it);\n  }\n}\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport var isArray = /*@__PURE__*/ (function () { return Array.isArray || (function (x) { return x && typeof x.length === 'number'; }); })();\n//# sourceMappingURL=isArray.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function isObject(x) {\n    return x !== null && typeof x === 'object';\n}\n//# sourceMappingURL=isObject.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nvar UnsubscriptionErrorImpl = /*@__PURE__*/ (function () {\n    function UnsubscriptionErrorImpl(errors) {\n        Error.call(this);\n        this.message = errors ?\n            errors.length + \" errors occurred during unsubscription:\\n\" + errors.map(function (err, i) { return i + 1 + \") \" + err.toString(); }).join('\\n  ') : '';\n        this.name = 'UnsubscriptionError';\n        this.errors = errors;\n        return this;\n    }\n    UnsubscriptionErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);\n    return UnsubscriptionErrorImpl;\n})();\nexport var UnsubscriptionError = UnsubscriptionErrorImpl;\n//# sourceMappingURL=UnsubscriptionError.js.map\n","/** PURE_IMPORTS_START _util_isArray,_util_isObject,_util_isFunction,_util_UnsubscriptionError PURE_IMPORTS_END */\nimport { isArray } from './util/isArray';\nimport { isObject } from './util/isObject';\nimport { isFunction } from './util/isFunction';\nimport { UnsubscriptionError } from './util/UnsubscriptionError';\nvar Subscription = /*@__PURE__*/ (function () {\n    function Subscription(unsubscribe) {\n        this.closed = false;\n        this._parentOrParents = null;\n        this._subscriptions = null;\n        if (unsubscribe) {\n            this._unsubscribe = unsubscribe;\n        }\n    }\n    Subscription.prototype.unsubscribe = function () {\n        var errors;\n        if (this.closed) {\n            return;\n        }\n        var _a = this, _parentOrParents = _a._parentOrParents, _unsubscribe = _a._unsubscribe, _subscriptions = _a._subscriptions;\n        this.closed = true;\n        this._parentOrParents = null;\n        this._subscriptions = null;\n        if (_parentOrParents instanceof Subscription) {\n            _parentOrParents.remove(this);\n        }\n        else if (_parentOrParents !== null) {\n            for (var index = 0; index < _parentOrParents.length; ++index) {\n                var parent_1 = _parentOrParents[index];\n                parent_1.remove(this);\n            }\n        }\n        if (isFunction(_unsubscribe)) {\n            try {\n                _unsubscribe.call(this);\n            }\n            catch (e) {\n                errors = e instanceof UnsubscriptionError ? flattenUnsubscriptionErrors(e.errors) : [e];\n            }\n        }\n        if (isArray(_subscriptions)) {\n            var index = -1;\n            var len = _subscriptions.length;\n            while (++index < len) {\n                var sub = _subscriptions[index];\n                if (isObject(sub)) {\n                    try {\n                        sub.unsubscribe();\n                    }\n                    catch (e) {\n                        errors = errors || [];\n                        if (e instanceof UnsubscriptionError) {\n                            errors = errors.concat(flattenUnsubscriptionErrors(e.errors));\n                        }\n                        else {\n                            errors.push(e);\n                        }\n                    }\n                }\n            }\n        }\n        if (errors) {\n            throw new UnsubscriptionError(errors);\n        }\n    };\n    Subscription.prototype.add = function (teardown) {\n        var subscription = teardown;\n        if (!teardown) {\n            return Subscription.EMPTY;\n        }\n        switch (typeof teardown) {\n            case 'function':\n                subscription = new Subscription(teardown);\n            case 'object':\n                if (subscription === this || subscription.closed || typeof subscription.unsubscribe !== 'function') {\n                    return subscription;\n                }\n                else if (this.closed) {\n                    subscription.unsubscribe();\n                    return subscription;\n                }\n                else if (!(subscription instanceof Subscription)) {\n                    var tmp = subscription;\n                    subscription = new Subscription();\n                    subscription._subscriptions = [tmp];\n                }\n                break;\n            default: {\n                throw new Error('unrecognized teardown ' + teardown + ' added to Subscription.');\n            }\n        }\n        var _parentOrParents = subscription._parentOrParents;\n        if (_parentOrParents === null) {\n            subscription._parentOrParents = this;\n        }\n        else if (_parentOrParents instanceof Subscription) {\n            if (_parentOrParents === this) {\n                return subscription;\n            }\n            subscription._parentOrParents = [_parentOrParents, this];\n        }\n        else if (_parentOrParents.indexOf(this) === -1) {\n            _parentOrParents.push(this);\n        }\n        else {\n            return subscription;\n        }\n        var subscriptions = this._subscriptions;\n        if (subscriptions === null) {\n            this._subscriptions = [subscription];\n        }\n        else {\n            subscriptions.push(subscription);\n        }\n        return subscription;\n    };\n    Subscription.prototype.remove = function (subscription) {\n        var subscriptions = this._subscriptions;\n        if (subscriptions) {\n            var subscriptionIndex = subscriptions.indexOf(subscription);\n            if (subscriptionIndex !== -1) {\n                subscriptions.splice(subscriptionIndex, 1);\n            }\n        }\n    };\n    Subscription.EMPTY = (function (empty) {\n        empty.closed = true;\n        return empty;\n    }(new Subscription()));\n    return Subscription;\n}());\nexport { Subscription };\nfunction flattenUnsubscriptionErrors(errors) {\n    return errors.reduce(function (errs, err) { return errs.concat((err instanceof UnsubscriptionError) ? err.errors : err); }, []);\n}\n//# sourceMappingURL=Subscription.js.map\n","/** PURE_IMPORTS_START  PURE_IMPORTS_END */\nexport function isFunction(x) {\n    return typeof x === 'function';\n}\n//# sourceMappingURL=isFunction.js.map\n","import { useState, useEffect } from 'react';\nimport { Subscription, Subject } from 'rxjs';\n\ntype BlocBuilderProps<T> = {\n  initialValue: T;\n  subject: Subject<T>;\n  builder: (snapshot: {\n    data: T;\n    connectionState: number;\n    error?: any;\n  }) => JSX.Element;\n};\n\ntype BlocBuilderState<T> = {\n  snapshot: { data: T, connectionState: number, error?: any };\n}\n\nexport const BlocBuilder = <T,>(props: BlocBuilderProps<T>) => {\n  const [state, setState] = useState<BlocBuilderState<T>>({\n    snapshot: {\n      data: props.initialValue,\n      connectionState: -1,\n      error: undefined,\n    },\n  });\n\n  useEffect(() => {\n    const _disposables = new Subscription();\n    const it = props.subject.subscribe({\n      next: (data: T) => {\n        setState({\n          snapshot: {\n            data: data,\n            connectionState: 0,\n            error: undefined,\n          },\n        });\n      },\n      error: (err: any) => {\n        setState({\n          snapshot: {\n            data: props.initialValue,\n            connectionState: 1,\n            error: err,\n          },\n        });\n      },\n      complete: () => {\n        setState({\n          snapshot: {\n            data: props.initialValue,\n            connectionState: 1,\n            error: undefined,\n          },\n        });\n      },\n    });\n    _disposables.add(it);\n    return () => {\n      _disposables.unsubscribe();\n    };\n  }, [props]);\n\n  return props.builder(state.snapshot);\n};\n","import React, { useRef, useEffect } from 'react'\nimport { DataBloc } from './data_bloc';\nimport { BlocBuilder } from 'react-blocbuilder'\n\nconst App = () => {\n  const bloc = useRef(new DataBloc());\n\n  useEffect(() => {\n    const _bloc = bloc.current;\n    return () => {\n      _bloc.dispose();\n    };\n  }, []);\n\n  return (\n    <div style={{ margin: '20px 20px' }}>\n      <h1>BlocBuilder Demo</h1>\n      <BlocBuilder\n        initialValue={bloc.current.list.getValue()}\n        subject={bloc.current.list}\n        builder={snapshot => {\n          return (\n            <p>{JSON.stringify(snapshot.data)}</p>\n          );\n        }}\n      />\n      <button onClick={() => bloc.current.getData()}>Get Data</button>\n      <button onClick={() => bloc.current.list.next([])}>Clear Data</button>\n    </div>\n  );\n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}